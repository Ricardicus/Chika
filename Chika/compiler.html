<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Chika compiler</title>
    <script src="compile.js"></script> 
    <script>
const e  = (el) => document.querySelector(el);
const es = (el) => document.querySelectorAll(el);

function DOM_compile () {
  const compiled = compile(e("textarea").value);
  const imageHex = compiled.image.join("")
  e("#assembly").value = compiled.assembly;
  e("#image").value = imageHex + "\n\n\n0x" + imageHex.match(/.{2}/g).join(", 0x");
  e("size").innerHTML = (imageHex.length / 2) + "B";
}
    </script>
    <style>
textarea {
  width: 11rem;
  height: 20rem;
}
.wide {
  width: 20rem;
}
    </style>
  </head>
  <body>
    <div>
      <textarea class="wide">(let morse {0x01 \\a 0x1000 \\b})
(var presses [] start 0 timer nil)

(fn ms->morse arr-ms
  (let arr-ms (map @(<= 320) arr-ms))
  (reduce | (map << arr-ms (range))))

(fn send-char
  (reset presses)
  (msg! "firm/keyboard/char"
    (morse (ms->morse presses))))

(fn hard-in topic payload
  (stop-timer! timer)
  (let diff-ms (- (time/now) start))
  (when (= 0 payload)
    (set presses (add presses diff-ms))
    (set timer (timeout! send-char 320))))

(hook! hard-in "hard/keyboard/+")</textarea>
      <textarea id="assembly"></textarea>
      <textarea id="image"></textarea>
    </div>
    <div>
      <button onclick="DOM_compile()">Compile</button>
    </div>
    <size>0B<size>
  </body>
</html>
